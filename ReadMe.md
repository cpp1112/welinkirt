#系统设计说明

##主要模块

###RTSP服务
    职责：模拟rtsp视频源
    实现：使用ffmpeg+rtsp服务器将本地MP4文件转换为 RTSP 流并循环播放
    输出：提供稳定的RTSP流地址,如rtsp://127.0.0.1:8554/stream

###Flask/FastAPI服务器
    职责：提供RESTful API接口
    接口：
        1. POST /clip  接收时间戳参数，立即返回任务ID
        2. GET /task/<task_id>/status  查询任务状态和结果
    特性：轻量级，只处理请求/响应，不执行耗时操作

###异步Worker
    职责：
        1. 维护视频缓存，从 RTSP 流持续读取并缓存视频帧。（因为rtsp为实时流，无法获取历史帧，故维持一个40s缓存窗口。）
        2. 处理剪辑任务（从缓存中提取指定时间段的视频）
        3. 将生成的视频保存到指定位置
    数据流：从Redis队列获取视频提取任务，处理完成后更新任务状态

##支持服务
    Redis：用于任务队列和任务状态存储
    Nginx：用于提供静态文件下载服务和app端口转发服务

##优化建议
对于生产环境，可能需要考虑以下改进：
    1. 身份验证与鉴权，为API添加认证机制。
    2. 使用WebSocket实时通知代替前端轮询任务状态。
    3. 任务优先级处理。为任务添加优先级字段，确保重要任务优先处理。
    4. 实现任务超时机制，避免长时间运行的任务占用资源。
    5. 结果缓存，对相同的剪辑请求返回缓存结果，避免重复处理。
    6. 结果视频设置结果有效期，自动清理过期的视频文件。
    7. 性能优化：使用FFmpeg进行视频处理（更高效）等。
    8. 监控告警
       • 添加健康检查接口，确保服务正常运行
       • 集成监控工具（如 Prometheus）跟踪系统性能指标

##扩展性考虑
    1. 支持多个视频流同时处理。
    2. 使用消息队列代替redis。
    3. 扩展Worker数量来处理更多并发任务。
    4. 对于大规模部署，可以考虑使用云存储服务（如 S3）代替本地文件系统。




